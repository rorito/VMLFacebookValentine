function showHide(a,b){if(!DEBUG){$(b).hide();$(a).fadeIn(FADEIN_DELAY)}}function contactValentine(){FB.ui({method:"send",to:VALENTINE,name:"You're my Facebook Valentine!",link:ROOT_URL,picture:ROOT_URL+"/img/app_icon.gif",description:MESSAGE},function(a){if(a){showHide("#happy","#message")}else{};})}function resetLoader(a){a.each(function(a,b){$this=$(b);$this.hide();$this.delay(LIKE_DELAY*a).fadeIn(FADEIN_DELAY)});window.setTimeout(function(){LOADER_FINISHED=true;resetLoader(a)},LIKE_DELAY*a.length+1)}function showLoader(){window.setTimeout(onTimeout,globalTimeout);showHide("#loader","#welcome");var a=$("#loader li");resetLoader(a);$(".fbText").delay(LIKE_DELAY*a.length+1).fadeIn(FADEIN_DELAY);waitForImageLoad()}function waitForImageLoad(){if(IMAGE_LOADED&&LOADER_FINISHED){showHide("#result","#loader")}else{setTimeout(waitForImageLoad,500)}}function setResult(a,b){$(".name").text(a);if(!DEBUG){$(".frame img").attr("src",b).bind("load",function(a){if($("#result").css("display")!="none"){$target=$(a.currentTarget);$target.css("margin-top",110-$target.outerHeight()/2)}else{$("#result").css({visibility:"hidden",position:"absolute",display:"block"});$target=$(a.currentTarget);$target.css("margin-top",110-$target.outerHeight()/2);$("#result").css({visibility:"visible",position:"relative",display:"none"})}})}else{$(".frame img").attr("src",topPic).bind("load",function(a){$target=$(a.currentTarget);$target.css("margin-top",110-$target.outerHeight()/2)})}IMAGE_LOADED=true}function parseTopLikers(){if(topLikers.length<1){topLikers.push("")}FB.api({method:"fql.query",query:"SELECT uid, first_name, last_name, pic_big FROM user WHERE uid = "+topLikers[0].toString()},function(a){if(a.length>0){var b=a[0].first_name+" "+a[0].last_name+" liked you "+highestCount+" times!";var c=a[0].pic_big;VALENTINE=a[0].uid;setResult(b,c)}else{var b="Yourself.";$(".text").text("You seem to be the only one who likes your posts. (Well, at least you can give yourself a big old hug!)");$(".facebook-continue").hide();var c;FB.api("/me/?fields=picture&type=large",function(a){if(a&&a.picture){c=a.picture}else{c="img/test.jpg"}window.setTimeout(function(){showHide("#happy","#result")},LIKE_DELAY*$("#loader li").length+NO_LIKE_DEALY);b=TEST?"img/test.jpeg":_topPic;c=TEST?"Nobody.":_topName;setResult(b,c)})}})}function countLikes(){showLoader();countPostLikes()}function countPostLikes(){FB.api("/me/posts&limit=500",function(a){collateLikes(a);countAlbumLikes()})}function countPhotoLikes(){FB.api({method:"fql.query",query:"select user_id, object_id from like where object_id in (select object_id from photo WHERE aid IN (select aid from album WHERE owner=me() LIMIT 15))"},function(a){for(var b=0;b<a.length;b++){if(a[b].hasOwnProperty("user_id")){addUserTrackHighest(a[b]["user_id"])}}parseTopLikers()})}function countAlbumLikes(){FB.api({method:"fql.query",query:"select user_id from like where object_id IN (select object_id from album WHERE owner=me() LIMIT 25)"},function(a){for(var b=0;b<a.length;b++){if(a[b].hasOwnProperty("user_id")){addUserTrackHighest(a[b]["user_id"])}}countPhotoLikes()})}function collateLikes(a){var b="";var c=[];if(a.data&&a.data.length>0){for(var d=0;d<a.data.length;d++){if(a.data[d].likes&&a.data[d].likes.count>0){postsWithLikes++;c=a.data[d].likes.data;for(var e=0;e<c.length;e++){totalPostLikes++;b=c[e].id;addUserTrackHighest(b)}}}}}function addUserTrackHighest(a){if(user_id_counts.hasOwnProperty(a)){user_id_counts[a]++}else{user_id_counts[a]=1}if(user_id_counts[a]>highestCount){topLikers=[];highestCount=user_id_counts[a];topLikers.push(a)}else if(user_id_counts[a]==highestCount){topLikers.push(a)}}function fbLoginStatus(a){if(TIMEDOUT){clickedFBLoginButton=true}if(a.authResponse&&clickedFBLoginButton){$(".fb-login-button").hide();countLikes()}else if(a.authResponse){$(".fb-login-button").hide();$(".welcome-continue").click(function(){countLikes()});$(".welcome-continue").show()}}function onTimeout(){$(".fbText").text("Wow, post much? Our little search-bot is exhausted! Click refresh to try again.")}var ROOT_URL="http://www.wholikelikesyou.com";var VALENTINE="";var MESSAGE="";var DEBUG=false;var DEBUG_LIKE_SCREEN=false;var NO_LIKE_DEALY=5e3;var LIKE_DELAY=900;var FADEIN_DELAY=200;var globalTimeout=45e3;var TEST=false;var MP3=false;var OGG=false;var IMAGE_LOADED=false;var LOADER_FINISHED=false;var clickedFBLoginButton=false;var TIMEDOUT=false;$(document).ready(function(){$(".facebook-continue").click(function(){showHide("#message","#result")});$(".facebook-nothanks").click(function(){showHide("#happy","#result")});$(".menu li").click(function(){$this=$(this);MESSAGE=$("span",$this).text();contactValentine()});if(document.location.href.split("?").length>1&&document.location.href.split("?")[1].match("timeout")){TIMEDOUT=true}if(document.location.href.split("?").length>1&&document.location.href.split("?")[1].match("Gsj7pMbMpSQ")){TEST=true}if(!DEBUG){$("#loader").hide();$("#result").hide();$("#message").hide();$("#happy").hide();$("body").css("overflow-x","hidden")}if(navigator.appName!="Microsoft Internet Explorer"){var a=document.createElement("audio");if(a.canPlayType("audio/mpeg")=="maybe"||a.canPlayType("audio/mpeg")=="probably"){MP3=true}else if(a.canPlayType("audio/ogg")=="maybe"||a.canPlayType("audio/ogg")=="probably"){OGG=true}if(OGG||MP3){$audioElement=$(a);var b;var c;if(OGG){b=TEST?"sound/test.ogg":"sound/amour_final.ogg";c="audio/ogg"}else if(MP3){b=TEST?"sound/test.mp3":"sound/amour_final.mp3";c="audio/mpeg"}$audioElement.attr({volume:".5",autoplay:"autoplay",src:b,type:c});$("#audio-controls .mute").hide();$("#audio-controls").click(function(){if(a.paused){$("#audio-controls .mute").hide();$("#audio-controls .unmute").show();a.play()}else{$("#audio-controls .mute").show();$("#audio-controls .unmute").hide();a.pause()}});a.addEventListener("ended",function(){a.src=TEST?"sound/test.mp3":"sound/amour_final.mp3";a.play()});$("body").append(a)}else{$("#audio-controls").hide()}}else{$("#audio-controls").hide()}});var user_id_counts={};var highestCount=0;var topLikers=[];var postsWithLikes=0;var totalPostLikes=0